version: "3"

services:
  sveltekit-test:
    build:
      context: .
      dockerfile: dockerfiles/sveltekit/dev/Dockerfile
    entrypoint: ["npm", "run", "dev"]
    environment:
      - environment=test
      - algoliaApp=6868GHOPYM
    networks:
      - internal_network

  firebase:
    build:
      context: .
      dockerfile: dockerfiles/sveltekit/dev/Dockerfile
    environment:
      - algoliaApp=6868GHOPYM
      - environment=test
    entrypoint: ["npm", "run", "emulateCypress"]
    secrets:
      - algolia-private-api-key
    networks:
      - internal_network

  playwright:
    build:
      context: .
      dockerfile: dockerfiles/sveltekit/dev/Dockerfile
    volumes:
      - ./test-results/:/var/www/svelte/test-results
    environment:
      - CI=true
    networks:
      - internal_network

secrets:
  algolia-private-api-key:
    file: ./config/secret-algolia-key.txt  
networks:
  internal_network:
